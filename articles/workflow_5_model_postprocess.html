<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>IAS-pDT modelling workflow — 5. Model post-processing • IASDT.R</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="IAS-pDT modelling workflow — 5. Model post-processing">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">IASDT.R</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.03</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-modelling-workflow" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book"></span> Modelling workflow</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-modelling-workflow">
<li><a class="dropdown-item" href="../articles/workflow_1_overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/workflow_2_abiotic_data.html">Processing abiotic data</a></li>
    <li><a class="dropdown-item" href="../articles/workflow_3_biotic_data.html">Processing biotic data</a></li>
    <li><a class="dropdown-item" href="../articles/workflow_4_model_fitting.html">Model fitting</a></li>
    <li><a class="dropdown-item" href="../articles/workflow_5_model_postprocess.html">Model post-processing</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BioDT/IASDT.R/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="workflow_5_model_postprocess_files/kePrint-0.0.1/kePrint.js"></script><link href="workflow_5_model_postprocess_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>IAS-pDT modelling workflow — 5. Model post-processing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BioDT/IASDT.R/blob/main/vignettes/workflow_5_model_postprocess.Rmd" class="external-link"><code>vignettes/workflow_5_model_postprocess.Rmd</code></a></small>
      <div class="d-none name"><code>workflow_5_model_postprocess.Rmd</code></div>
    </div>

    
    
<style>
.ShortBlock {
  height: 400px;
  width: 100%;
}

summary {
  color: red;
  padding-left: 40px;
}

ff {
  background-color: #def5ff;
  color: black;
  font-style: italic;
}

cc {
  background-color: #f0f7eb;
  color: black;
  font-style: italic;
}

.ll:visited {
  color: blue; !important;
  text-decoration: none !important;
}

.ll:hover {
  text-decoration: underline !important;
  background-color: #d3f2aa !important;
  color: darkblue; important;
}

.ll:link, .ll:active {
  color: blue !important;
  text-decoration: none !important;
}

tab:before {
  content: "\00a0\00a0\00a0\00a0";
}

tab0:after {
  content: "\00a0\00a0";
}

table{
    width: 100% !important;
    margin-left: 50px !important;
}

table, th, td {
  padding: 1.8px !important;
  line-height: 1.3 !important;
}

.hr1 {
    width: 90%;
    margin-left: auto;
    margin-right: auto;
    border-top: 6px groove blue;
    margin: 30px auto;
    height: 4px;
    background-color: blue;
}

.hr2 {
    width: 50%;
    margin-left: auto;
    margin-right: auto;
    border-top: 6px groove orange;
    margin: 25px auto;
    height: 2px;
    background-color: orange;
}

br {
  display: block;
  margin: 4px 0;
}
</style>
<p><br></p>
<p>Post-processing of fitted models within the <code>IAS-pDT</code>
workflow is conducted across multiple steps, leveraging both CPU and GPU
computations to optimize performance and address memory constraints.</p>
<p><br></p>
<div class="section level2">
<h2 id="step-1-cpu">Step 1: CPU<a class="anchor" aria-label="anchor" href="#step-1-cpu"></a>
</h2>
<p>The <strong><code><a href="../reference/Mod_postprocessing.html">Mod_Postprocess_1_CPU()</a></code></strong> function
initiates the post-processing phase for each habitat type, automating
the following tasks:</p>
<table class="table table table-condensed table-hover" style="font-size: 16px; margin-left: auto; margin-right: auto;"><tbody>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Mod_SLURM.html">Mod_SLURM_Refit()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
check for unsuccessful model fits
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Mod_Merge_Chains.html">Mod_Merge_Chains()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
merge MCMC chains and saves fitted model and coda objects to <i>.qs2</i>
or <i>.RData</i> files
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Convergence_Plot_All.html">Convergence_Plot_All()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
visualize convergence of <code>rho</code>, <code>alpha</code>,
<code>omega</code>, and <code>beta</code> parameters across all model
variants; unnecessary for a single variant, this function compares
convergence across models with varying thinning values, both with and
without phylogenetic relationships, or GPP knot distances
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Convergence_plots.html">Convergence_Plot()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
convergence of <code>rho</code>, <code>alpha</code>, <code>omega</code>,
and <code>beta</code> parameters for a selected model, offering a
detailed view compared to <code><a href="../reference/Convergence_Plot_All.html">Convergence_Plot_All()</a></code>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/PlotGelman.html">PlotGelman()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
visualize Gelman-Rubin-Brooks diagnostics for the selected model
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Mod_Summary.html">Mod_Summary()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
extract and save a summary of the model
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Parameter_Heatmap.html">Mod_Heatmap_Beta()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
generate heatmaps of the <code>beta</code> parameters
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Parameter_Heatmap.html">Mod_Heatmap_Omega()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
generates heatmaps of the <code>omega</code> parameter (residual species
associations)
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Mod_CV_Fit.html">Mod_CV_Fit()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
prepare input data for spatial-block cross-validation model fitting
</td>
</tr>
</tbody></table>
<p>Previous attempts to prepare response curve data, predict at new
sites, and compute variance partitioning using R on CPUs (UFZ Windows
server and LUMI HPC) were hindered by memory limitations. Consequently,
these tasks are offloaded to GPU-based computations using Python and
TensorFlow. The <code><a href="../reference/Mod_postprocessing.html">Mod_Postprocess_1_CPU()</a></code> function invokes
the following sub-functions to generate commands for GPU execution:</p>
<table class="table table table-condensed table-hover" style="font-size: 16px; margin-left: auto; margin-right: auto;"><tbody>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Response_curves.html">RespCurv_PrepData()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
prepare data for predicting latent factors for response curves
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Predict_Maps.html">Predict_Maps()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
prepare data for predicting latent factors at new sampling units
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 4em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Variance_partitioning.html">VarPar_Compute()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
prepare data for computing variance partitioning
</td>
</tr>
</tbody></table>
<br><hr class="hr2">
<p><br></p>
<div class="section level3">
<h3 id="prepare-commands-for-gpu-computations">Prepare commands for GPU computations<a class="anchor" aria-label="anchor" href="#prepare-commands-for-gpu-computations"></a>
</h3>
<blockquote>
<p><u><i>Predicting latent factors:</i></u></p>
</blockquote>
<ul>
<li>Latent factor predictions for response curves and new sampling units
are executed via a TensorFlow script located at
<ff>inst/crossprod_solve.py</ff>.</li>
<li>For these tasks, the respective R functions export numerous
<i>.qs2</i> and <i>.feather</i> data files to the <ff>TEMP_Pred</ff>
subdirectory, essential for GPU computations. They also generate
execution commands saved as <ff>LF_RC_Commands_<em>.txt</em></ff> (for
response curves) and <ff>LF_NewSites_Commands_.txt</ff> (for new
sites).</li>
</ul>
<details><summary>
Example LF_RC_Commands.txt file
</summary></details><details><summary>
Example LF_NewSites_Commands.txt file
</summary></details><p><br><br></p>
<ul>
<li>Response curves
<ul>
<li>
<code><a href="../reference/Response_curves.html">RespCurv_PrepData()</a></code> extends
<code><a href="https://rdrr.io/pkg/Hmsc/man/constructGradient.html" class="external-link">Hmsc::constructGradient()</a></code> and
<code><a href="https://rdrr.io/pkg/Hmsc/man/plotGradient.html" class="external-link">Hmsc::plotGradient()</a></code>, enabling GPU-based response curve
data preparation when
<cc><code>LF_Commands_Only = TRUE</code></cc>.<br>
</li>
<li>To predict at mean coordinates (per the <i>coordinates</i> argument
of <code><a href="https://rdrr.io/pkg/Hmsc/man/constructGradient.html" class="external-link">Hmsc::constructGradient()</a></code>), latent factor
predictions—typically memory-intensive with
<code><a href="https://rdrr.io/pkg/Hmsc/man/predictLatentFactor.html" class="external-link">Hmsc::predictLatentFactor()</a></code>—are computed on GPUs.</li>
</ul>
</li>
<li>Predicting at new sites
<ul>
<li>
<code><a href="../reference/Predict_Maps.html">Predict_Maps()</a></code> prepares GPU computations for new site
predictions when
<cc><code>LF_Only = TRUE&lt;/cc&gt; and &lt;cc&gt;LF_Commands_Only = TRUE</code></cc>.</li>
</ul>
</li>
</ul>
<p><br><br></p>
<blockquote>
<p><u><i>Computing variance partitioning:</i></u></p>
</blockquote>
<ul>
<li>Variance partitioning computations on GPUs are executed using
TensorFlow scripts at <ff>inst/VP_geta.py</ff>,
<ff>inst/VP_getf.py</ff>, and <ff>inst/VP_gemu.py</ff>.</li>
<li>
<code><a href="../reference/Variance_partitioning.html">VarPar_Compute()</a></code> exports required files to the
<ff>TEMP_VP</ff> subdirectory, including numerous <i>.qs2</i> and
<i>.feather</i> files, and generates execution commands saved as
<ff>VP_A_Command.txt</ff>, <ff>VP_F_Command.txt</ff>, and
<ff>VP_mu_Command.txt</ff>.</li>
</ul>
<p><br><br></p>
</div>
<div class="section level3">
<h3 id="combining-commands-for-gpu-computations">Combining commands for GPU computations<a class="anchor" aria-label="anchor" href="#combining-commands-for-gpu-computations"></a>
</h3>
<p>After executing <code><a href="../reference/Mod_postprocessing.html">Mod_Postprocess_1_CPU()</a></code> for all habitat
types, the <strong><code><a href="../reference/Mod_postprocessing.html">Mod_Prep_TF()</a></code></strong> function
consolidates batch scripts for GPU computations across all habitat
types:</p>
<ul>
<li>It aggregates script files containing commands for response curves
and latent factor predictions, splitting them into multiple scripts for
batch processing, and generates a SLURM script (<ff>LF_SLURM.slurm</ff>)
for latent factor predictions.</li>
</ul>
<details><summary>
Example LF_SLURM.slurm file
</summary></details><p><br><br></p>
<ul>
<li>It consolidates variance partitioning command files into a single
<ff>VP_Commands.txt</ff> and prepares a SLURM script
(<ff>VP_SLURM.slurm</ff>) for variance partitioning computations.</li>
</ul>
<details><summary>
Example VP_Commands.txt file
</summary></details><details><summary>
Example VP_SLURM.slurm file
</summary></details><hr class="hr1">
</div>
</div>
<div class="section level2">
<h2 id="step-2-gpu">Step 2: GPU<a class="anchor" aria-label="anchor" href="#step-2-gpu"></a>
</h2>
<p>Latent factor predictions and variance partitioning are computed on
GPUs. Batch jobs can be submitted using the <code>sbatch</code>
command:</p>
<p>Cross-validated models are fitted by submitting corresponding SLURM
commands (<em>in preparation</em>):</p>
<hr class="hr1">
</div>
<div class="section level2">
<h2 id="step-3-cpu">Step 3: CPU<a class="anchor" aria-label="anchor" href="#step-3-cpu"></a>
</h2>
<p>The <code><a href="../reference/Mod_postprocessing.html">Mod_Postprocess_2_CPU()</a></code> function advances the
post-processing pipeline for HMSC models on the CPU, automating the
following tasks:</p>
<table class="table table table-condensed table-hover" style="font-size: 16px; margin-left: auto; margin-right: auto;"><tbody>
<tr>
<td style="text-align:left;padding-left: 2em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Response_curves.html">RespCurv_PrepData()</a></code>,<br><code><a href="../reference/Response_curves.html">RespCurv_PlotSR()</a></code>,<br><code><a href="../reference/Response_curves.html">RespCurv_PlotSp()</a></code>,<br><code><a href="../reference/Response_curves.html">RespCurv_PlotSpAll()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
continue processing and visualizing response curves
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Predict_Maps.html">Predict_Maps()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
predict habitat suitability across climate scenarios, compute model
explanatory power (internal evaluation), and prepare maps for the Shiny
app
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Mod_Predict_Plot.html">Mod_Predict_Plot()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
visualize species and species richness predictions as JPEG images
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Mod_Plot_LF.html">Mod_Plot_LF()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
visualize spatial variation in site loadings of HMSC models as JPEG
images
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Variance_partitioning.html">VarPar_Compute()</a></code>,<br><code><a href="../reference/Variance_partitioning.html">VarPar_Plot()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
continue processing and visualize variance partitioning
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;white-space: nowrap;" indentlevel="1">
<cc><code><a href="../reference/Mod_Eval_Plot.html">Mod_Eval_Plot()</a></code></cc><tab0></tab0>
</td>
<td style="text-align:left;">
visualize explanatory power (internal model evaluation)
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;white-space: nowrap;" indentlevel="1">
<cc><em>In preparation…</em></cc><tab0></tab0>
</td>
<td style="text-align:left;">
initiate post-processing of fitted cross-validated models and prepare
GPU commands for latent factor predictions
</td>
</tr>
</tbody></table>
<hr class="hr1">
</div>
<div class="section level2">
<h2 id="step-4-gpu">Step 4: GPU<a class="anchor" aria-label="anchor" href="#step-4-gpu"></a>
</h2>
<p>Predicting latent factors for cross-validated models on GPUs (<em>in
preparation</em>).</p>
<hr class="hr1">
</div>
<div class="section level2">
<h2 id="step-5-cpu">Step 5: CPU<a class="anchor" aria-label="anchor" href="#step-5-cpu"></a>
</h2>
<p>Evaluating the performance of cross-validated models (<em>in
preparation</em>).</p>
<hr class="hr1">
<p><span style="font-size: 1.2em; line-height: 0.8;"> <b>Previous
articles:</b><br><tab>↠<tab><a href="workflow_1_overview.html" class="ll">1.
Overview</a><br><tab>↠<tab><a href="workflow_2_abiotic_data.html" class="ll">2.
Processing abiotic data</a><br><tab>↠<tab><a href="workflow_3_biotic_data.html" class="ll">3.
Processing biotic data</a><br><tab>↠<tab><a href="workflow_4_model_fitting.html" class="ll">4. Model
fitting</a><br></tab></tab></tab></tab></tab></tab></tab></tab></span></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://elgabbas.netlify.app/" class="external-link">Ahmed El-Gabbas</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
